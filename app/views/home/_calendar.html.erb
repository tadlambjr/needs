<div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-8">
  <div class="flex items-center justify-between mb-6">
    <h2 class="text-2xl font-semibold">6-Week Calendar</h2>
    <%= link_to "Full Calendar View", calendar_needs_path, class: "text-indigo-600 hover:text-indigo-800 text-sm font-medium" %>
  </div>

  <!-- Day headers -->
  <div class="grid grid-cols-7 border-b border-gray-200 dark:border-gray-700">
    <% %w[Sun Mon Tue Wed Thu Fri Sat].each do |day| %>
      <div class="text-center text-xs sm:text-sm font-semibold text-gray-600 dark:text-gray-400 py-2">
        <%= day %>
      </div>
    <% end %>
  </div>

  <!-- Calendar grid -->
  <div class="relative">
    <% 
      # Get all dates for 6 weeks
      weeks = []
      current_date = @calendar_start
      6.times do |week_num|
        week = []
        7.times do
          week << current_date
          current_date = current_date + 1.day
        end
        weeks << week
      end

      # Create a hash of needs by date for quick lookup
      needs_by_date = Hash.new { |h, k| h[k] = [] }
      @calendar_needs.each do |need|
        date_range = (need.start_date..need.end_date).to_a
        date_range.each do |date|
          if date >= @calendar_start && date <= @calendar_end
            needs_by_date[date] << need
          end
        end
      end
    %>

    <%= render "shared/calendar_grid", 
        weeks: weeks, 
        needs_by_date: needs_by_date,
        calendar_start: @calendar_start,
        calendar_end: @calendar_end,
        current_month: Date.today,
        upcoming_signups: @upcoming_signups,
        show_past_opacity: true,
        min_height: 100,
        max_events_shown: 3,
        has_gaps: false %>
  </div>

  <!-- Legend -->
  <div class="mt-6 pt-4 border-t border-gray-200 dark:border-gray-700 flex flex-wrap gap-4 text-sm">
    <div class="flex items-center">
      <div class="w-4 h-4 border-2 border-indigo-500 bg-indigo-50 dark:bg-indigo-900/20 rounded mr-2"></div>
      <span class="text-gray-600 dark:text-gray-400">Today</span>
    </div>
    <div class="flex items-center">
      <div class="w-2 h-2 bg-green-500 rounded-full mr-2"></div>
      <span class="text-gray-600 dark:text-gray-400">You're signed up</span>
    </div>
    <div class="flex items-center">
      <div class="w-4 h-4 bg-indigo-100 dark:bg-indigo-900 rounded mr-2"></div>
      <span class="text-gray-600 dark:text-gray-400">Available needs</span>
    </div>
    <div class="flex items-center">
      <div class="w-4 h-4 bg-gray-200 dark:bg-gray-700 rounded mr-2"></div>
      <span class="text-gray-600 dark:text-gray-400">Full needs</span>
    </div>
  </div>
</div>
