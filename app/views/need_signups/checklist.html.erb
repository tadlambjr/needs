<div class="max-w-3xl mx-auto" data-controller="checklist">
  <!-- Header -->
  <div class="mb-6">
    <%= link_to need_path(@need), class: "inline-flex items-center text-teal-600 hover:text-teal-800 mb-4" do %>
      <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
      </svg>
      Back to Need
    <% end %>
  </div>

  <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden">
    <!-- Title Section -->
    <div class="p-6 border-b border-gray-200 dark:border-gray-700">
      <h1 class="text-3xl font-bold mb-2"><%= @checklist.name %></h1>
      <p class="text-gray-600 dark:text-gray-400">For: <%= @need.title %></p>
      <div class="mt-4 flex items-center gap-2">
        <div class="flex-1 bg-gray-200 dark:bg-gray-700 rounded-full h-3">
          <div data-checklist-target="progressBar" class="bg-green-500 h-3 rounded-full transition-all duration-300" style="width: 0%"></div>
        </div>
        <span data-checklist-target="progressText" class="text-sm font-medium text-gray-600 dark:text-gray-400 min-w-[4rem]">0 / <%= @checklist_items.count %></span>
      </div>
    </div>

    <!-- Checklist Items -->
    <div class="p-6">
      <div class="space-y-3">
        <% @checklist_items.each_with_index do |item, index| %>
          <button
            type="button"
            data-checklist-target="item"
            data-action="click->checklist#toggleItem touchstart->checklist#toggleItem"
            style="touch-action: manipulation;"
            class="group flex items-start p-5 bg-gray-50 dark:bg-gray-900 rounded-lg border-2 border-gray-200 dark:border-gray-700 cursor-pointer hover:border-teal-400 dark:hover:border-teal-500 transition-all duration-200 hover:shadow-md w-full text-left focus:outline-none focus:ring-2 focus:ring-teal-500 active:scale-[0.99]">

            <!-- Checkbox -->
            <div class="flex-shrink-0 mr-4 mt-1 pointer-events-none">
              <div data-checklist-target="checkbox" class="w-10 h-10 rounded-lg border-3 border-gray-300 dark:border-gray-600 group-hover:border-teal-500 transition-all duration-200 flex items-center justify-center bg-white dark:bg-gray-800">
                <svg data-checklist-target="checkmark" class="w-7 h-7 text-white hidden" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                </svg>
              </div>
            </div>

            <!-- Item Text -->
            <div class="flex-1 min-w-0 pointer-events-none">
              <p data-checklist-target="itemText" class="text-lg font-medium text-gray-900 dark:text-gray-100 group-hover:text-teal-600 dark:group-hover:text-teal-400 transition-colors select-none">
                <%= item.description %>
              </p>
            </div>
          </button>
        <% end %>
      </div>
    </div>

    <!-- Complete Button -->
    <div class="p-6 bg-gray-50 dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700">
      <div class="flex flex-col gap-3">
        <button
          type="button"
          data-checklist-target="markAllButton"
          data-action="click->checklist#markAllComplete"
          class="w-full px-6 py-3 bg-teal-100 dark:bg-teal-900 text-teal-700 dark:text-teal-300 font-semibold rounded-lg hover:bg-teal-200 dark:hover:bg-teal-800 transition-colors border-2 border-teal-300 dark:border-teal-700 hover:border-teal-400 dark:hover:border-teal-600 focus:outline-none focus:ring-2 focus:ring-teal-500 active:scale-[0.98]">
          Mark All as Completed
        </button>

        <%= button_to "All Done!",
            mark_complete_need_signup_path(@need_signup),
            method: :patch,
            data: {
              checklist_target: "completeButton",
              confirm: "Are you sure you've completed all the tasks?"
            },
            class: "w-full px-8 py-4 bg-green-600 text-white text-lg font-semibold rounded-lg hover:bg-green-700 transition-colors shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-green-500 active:scale-[0.98]",
            disabled: true %>
      </div>
    </div>
  </div>
</div>
